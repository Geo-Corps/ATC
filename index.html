<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Holtwood+One+SC" rel="stylesheet">
    <style>    
    </style>
  </head>
  <body>
    <!--The div element for the map -->
    <div id="canvas-container">
    <div id="map"></div>
        <div id='title'>Appalachian Trail</div>
        <div id='info-panel2'>
            <div class='layer-panel'>
                <div class='layer-panel-title'>selection///</div>
            <div class='layer-selector' id='btn-atCentLine'>The Trail</div>
            <div class='layer-selector' id='btn-atShelters'>Shelters</div>
            <div class='layer-selector' id='btn-atParking'>Parking</div>
                
                </div>
            
<!--
            <input type="button" class="button" id='btn-atCentLine' value="The Trail">
    <input type="button" class="button" id='btn-atShelters' value="Cabins">
    <input type="button" class="button" id='btn-atParking' value="Parking">
-->
            <div class="info-card" id='first-card'></div>
        </div>
        </div>
    <script>
        
// Initialize and add the map
    function initMap() {
        
        var hq = {lat: 36.6337, lng: -81.7837};
        // The map, centered at Conservancy HQ in Damascus, VA.
        var map = new google.maps.Map(
          document.getElementById('map'), {
              zoom: 4,
              center: hq,
              mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                    position: google.maps.ControlPosition.BOTTOM_CENTER,
                    disableDefaultUI: true,
                    mapTypeIds: [google.maps.MapTypeId.TERRAIN, google.maps.MapTypeId.SATELLITE, google.maps.MapTypeId.HYBRID]
                },
              mapTypeId: google.maps.MapTypeId.TERRAIN,
              streetViewControl: true,
              styles: [  
               {  
                  elementType:'geometry',
                  stylers:[  
                     {  
                        color:'#f5f5f5'
                     }
                  ]
               },
               {  
                  elementType:'labels.text.stroke',
                  stylers:[  
                     {  
                        visibility:'off'
                     }
                  ]
               },
               {  
                  elementType:'labels.text.fill',
                  stylers:[  
                     {  
                        visibility:'off'
                     }
                  ]
               },
               {  
                  featureType:'administrative.locality',
                  elementType:'labels.text.fill',
                  stylers:[  
                     {  
                        color:'#d59563'
                     }
                  ]
               },
               {  
                  featureType:'landscape',
                  elementType:'geometry.fill',
                  stylers:[  
                     {  
                        color:'#F5DEB3'
                     }
                  ]
               },
               {  
                  featureType:'landscape',
                  elementType:'geometry.stroke',
                  stylers:[  
                     {  
                        color:'CAF5B3'
                     }
                  ]
               },
               {  
                  featureType:"landscape.man_made",
                  elementType:"geometry",
                  stylers:[  
                     {  
                        visibility:'off'
                     }
                  ]
               },
               {  
                  featureType:"landscape.natural",
                  elementType:"geometry",
                  stylers:[  
                     {  
                        color:"#ffeb3b"
                     }
                  ]
               },
               {  
                  featureType:"landscape.natural",
                  elementType:"geometry.stroke",
                  stylers:[  
                     {  
                        color:"#808000"
                     },
                     {  
                        saturation:1
                     }
                  ]
               },
               {  
                  featureType:"landscape.natural.fill",
                  elementType:"geometry",
                  stylers:[  
                     {  
                        color:"#8FBC8F"
                     },
                     {  
                        visibility:'simplified'
                     },
                     {  
                        saturation:1
                     }
                  ]
               },
               {  
                  featureType:"landscape.natural.landcover",
                  elementType:"labels",
                  stylers:[  
                     {  
                        color:"CAF5B3"
                     },
                     {  
                        saturation:1
                     }
                  ]
               },
               {  
                  featureType:"landscape.natural.terrain",
                  elementType:"geometry.fill",
                  stylers:[  
                     {  
                        color:"#8FBC8F"
                     },
                     {  
                        visibility:'simplified'
                     },
                     {  
                        weight:5
                     }
                  ]
               },
               {  
                  featureType:'poi.park',
                  stylers:[  
                     {  
                        color:'#CAF5B3'
                     },
                     {  
                        visibility:'simplified'
                     }
                  ]
               },
               {  
                  featureType:'poi.park',
                  elementType:"labels",
                  stylers:[  
                     {  
                        color:'EBF5B3'
                     }
                  ]
               },
               {  
                  featureType:'transit',
                  stylers:[  
                     {  
                        visibility:'off'
                     }
                  ]
               },
               {  
                  featureType:'road',
                  elementType:'geometry',
                  stylers:[  
                     {  
                        color:'#38414e'
                     }
                  ]
               },
               {  
                  featureType:'road',
                  stylers:[  
                     {  
                        visibility:'off'
                     }
                  ]
               },
               {  
                  featureType:'road',
                  elementType:'geometry',
                  stylers:[  
                     {  
                        color:'#ffffff'
                     }
                  ]
               },
               {  
                  featureType:'road.arterial',
                  elementType:'labels.text.fill',
                  stylers:[  
                     {  
                        color:'#757575'
                     }
                  ]
               },
               {  
                  featureType:'road.highway',
                  elementType:'geometry',
                  stylers:[  
                     {  
                        color:'#746855'
                     }
                  ]
               },
               {  
                  featureType:'road.highway',
                  elementType:'geometry.stroke',
                  stylers:[  
                     {  
                        color:'#1f2835'
                     }
                  ]
               },
               {  
                  featureType:'road.highway',
                  elementType:'labels.text.fill',
                  stylers:[  
                     {  
                        color:'#f3d19c'
                     }
                  ]
               },
               {  
                  featureType:'water',
                  elementType:'geometry',
                  stylers:[  
                     {  
                        color:'#D2EFF5'
                     },
                     {  
                        saturation:1
                     }
                  ]
               },
               {  
                  featureType:'water',
                  elementType:'labels.text.fill',
                  stylers:[  
                     {  
                        color:'#9e9e9e'
                     }
                  ]
               },
               {  
                  featureType:'water',
                  elementType:'labels.text.stroke',
                  stylers:[  
                     {  
                        color:'#B3EBF5'
                     }
                  ]
               }
            ]
          }
        );
        
        // Trail Line
        
//        $.getJSON( "data/at_cent_small.geojson", function( data ) {
//            var atCentLineLayer = map.data.addGeoJson(data, { idPropertyName: 'CENT_LINE' });
//          
//        });
        
        
        // Parking Data
        
        var atParkingIconStyle = {
            url: 'https://geo-corps.github.io/ATC/data/icons/parking.svg',
            scaledSize: new google.maps.Size(10, 10)
        }
        
        
                
//        atParkingLayer.loadGeoJson(atParkingSrc);
//        atParkingLayer.setStyle({
//          icon: atParkingIconStyle
//        });
        
        $.getJSON( "data/at_parking.geojson", function( data ) {
            var atParkingLayer = map.data.addGeoJson(data, { idPropertyName: 'PARKING' });
            atParkingLayer.forEach(function (feature) {
                if(feature.getProperty('LAYERID')=="PARKING") {
              console.log('its a parking spot !!')
            // override existing style for this feature
                    map.data.overrideStyle(feature, {icon: atParkingIconStyle})
            
          };
            })
          });
//        map.data.setStyle(function(feature) {
//            return {
//              icon: atParkingIconStyle,
//            };
//        });
        
        // Shelter Data
        
        var atShelterIconStyle = {
            url: 'https://geo-corps.github.io/ATC/data/icons/roofing-contractor.svg',
            scaledSize: new google.maps.Size(20, 20)
        }
        
        $.getJSON( "data/at_shelters.geojson", function( data ) {
            var atSheltersLayer = map.data.addGeoJson(data, { idPropertyName: 'SHELTER' });
            atSheltersLayer.forEach(function (feature) {
                if(feature.getProperty('LAYERID')=="SHELTER") {
              console.log('its a shelter !!')
            // override existing style for this feature
                    map.data.overrideStyle(feature, {icon: atShelterIconStyle})
          };
            })
//            data.setMap(map)
        });
        
//        var atSheltersLayer = map.data.loadGeoJson('https://geo-corps.github.io/ATC/data/at_shelters.geojson', {idPropertyName: 'SHELTER' });
        
//        map.data.setStyle(function(feature) {
////            console.log(feature.getId());
////            console.log(feature.getProperty('LAYERID'));
//            
//            feature.forEachProperty {
//                console.log
//            }
//            var layerType = feature.getProperty('LAYERID');
//            console.log(layerType)
//            if (layerType = "CENT_LINE") {
//                  return {
//                      strokeColor: 'red',
//                      strokeWeight: 3
//                    };
//                };
//            });
        
//        map.data.setStyle(function(feature) {
//            var layerType = feature.getProperty('LAYERID');
//            if (layerType = 'SHELTER') {
//                    console.log('its a shelter')
//                  return {
//                      icon: atShelterIconStyle
//                    };
//                }
//            });
//        map.data.setStyle(function(feature) {
//            var layerType = feature.getProperty('LAYERID');
//            if (layerType = "PARKING") {
//                    return {
//                      icon: atParkingIconStyle
//                    };
//                }
//            });
        
//        map.data.forEach(function(feature) {
//            console.log(feature);
//          // is feature to be changed
//          if(feature.getProperty('LAYERID')=="SHELTER") {
//              console.log('its a shelter !!')
//            // override existing style for this feature
//            overrideStyle(feature,{
//                      icon: atShelterIconStyle
//                    });
//          }
//        });
//        
        map.data.addListener('click', function(event) {
            console.log(event.feature.getId());
            console.log(event.feature.getProperty('YEAR_BUILT'));
          });
        
        
//        console.log(atCentLineLayer.getId());
        
        map.data.addListener('mouseover', function(event) {
//            console.log(event.feature);
            $('#first-card').html("<div class='layer-title'>" + event.feature.getProperty('STATUS') + "</div><br>" + event.feature.getProperty('Name') + "<br>Built in " + event.feature.getProperty('YEAR_BUILT') + "<br>" + event.feature.getProperty('Elev_feet') + " Ft. Elev.<br>" + event.feature.getProperty('ROOF') + "<br>" + event.feature.getProperty('STATE') + "<br>" + event.feature.getProperty('TRAIL_CLUB')+ "<br>Comments: " + event.feature.getProperty('COMMENTS') + "<br>Source: " + event.feature.getProperty('SOURCE')+ "<br>");
//          document.getElementById('first-card').textContent =
//              event.feature.getProperty('Status') + "<br>" + event.feature.getProperty('Name') ;
        });

        // Set up empty data layers for data sources
        var atCentLineLayer = new google.maps.Data();
//        var atSheltersLayer = new google.maps.Data();
        var atParkingLayer = new google.maps.Data();
        
        // Set geojson to full URL to be able to load the layer locally, due to CORS error
        var atCentLineSrc = 'https://geo-corps.github.io/ATC/data/at_cent_small.geojson'
        var atSheltersSrc = 'https://geo-corps.github.io/ATC/data/at_shelters.geojson'
        var atParkingSrc = 'https://geo-corps.github.io/ATC/data/at_parking.geojson'
        
        // Load all layers and style rules
        atCentLineLayer.loadGeoJson(atCentLineSrc);
        atCentLineLayer.setStyle({
          strokeColor: 'red',
          strokeWeight: 3
        });
        
//        var atShelterIconStyle = {
//            url: 'https://geo-corps.github.io/ATC/data/icons/roofing-contractor.svg',
//            scaledSize: new google.maps.Size(20, 20)
//        }
        
//        atSheltersLayer.loadGeoJson(atSheltersSrc);
//        atSheltersLayer.setStyle({
//          icon: atShelterIconStyle
//        });
        
        
        
        // Add Layers to Map
        
        
        atCentLineLayer.setMap(map);
//        atSheltersLayer.setMap(map);
//        atParkingLayer.setMap(map);
        
        var atCentLineStatus = true;
        $("#btn-atCentLine").click(function() {
            $(this).trigger("blur"); // To dissable focus on button when clicked - temporary solution
            if (atCentLineStatus) {
                atCentLineLayer.setMap(null);
                atCentLineStatus = false;
            }
            else {
                atCentLineLayer.setMap(map);
                atCentLineStatus = true;
            }
        });
        var atSheltersStatus = false;
        $("#btn-atShelters").click(function() {
            $(this).trigger("blur");
            console.log("shelter button click");
            if (atSheltersStatus) {
//                atSheltersLayer.setMap(null);
                map.data.forEach(function (feature) {
                    if(feature.getProperty('LAYERID')=="SHELTER") {
//                  console.log('its a shelter !!')
                // override existing style for this feature
                        map.data.overrideStyle(feature, {visible: false})
              };
                })
                atSheltersStatus = false;
            }
            else {
                atSheltersLayer.setMap(map);
                atSheltersStatus = true;
            }
        });
        var atParkingStatus = false;
        $("#btn-atParking").click(function() {
            $(this).trigger("blur");
            if (atParkingStatus) {
                atParkingLayer.setMap(null);
                atParkingStatus = false;
            }
            else {
                atParkingLayer.setMap(map);
                atParkingStatus = true;
            }
        });
        
//        $("#btn-atCentLine").off('click');

    };
        
        // User & Data Ineraction
        
        

    </script>
    <!--Load APIs and execute early functions -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      
      
    <script>
    function styleMap() {
        $.getJSON('https://geo-corps.github.io/ATC/basemap-style.json', function(data) { 
        stylesATC = data;
        console.log('h')
        });
    };
    // Run styleMap function to load in base-map style file before map loads
    styleMap();
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8k09vVP7UOyx1IxMo-zoqFRcRTUo-vCw&callback=initMap">
    </script>
  </body>
</html>