<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Holtwood+One+SC" rel="stylesheet">
    <style>    
    </style>
  </head>
  <body>
    <!--The div element for the map -->
    <div class="canvas-container">
    <div id="map"></div>
        <div id='title'>Appalachian Trail</div>
        <br><br><br>
    <input type="button" class="button" id='btn-atCentLine' value="The Trail">
    <input type="button" class="button" id='btn-atShelters' value="Cabins">
    <input type="button" class="button" id='btn-atParking' value="Parking">
    </div>
    <script>
// Initialize and add the map
    function initMap() {
        
        var hq = {lat: 36.6337, lng: -81.7837};
        // The map, centered at Conservancy HQ in Damascus, VA.
        var map = new google.maps.Map(
          document.getElementById('map'), {
              zoom: 4,
              center: hq,
              mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                    position: google.maps.ControlPosition.BOTTOM_CENTER
                },
              streetViewControl: true
          });

        // Set up empty data layers for data sources
        var atCentLineLayer = new google.maps.Data();
        var atSheltersLayer = new google.maps.Data();
        var atParkingLayer = new google.maps.Data();
        
        // Set geojson to full URL to be able to load the layer locally, due to CORS error
        var atCentLineSrc = 'https://geo-corps.github.io/ATC/data/at_cent_small.geojson'
        var atSheltersSrc = 'https://geo-corps.github.io/ATC/data/at_shelters.geojson'
        var atParkingSrc = 'https://geo-corps.github.io/ATC/data/at_parking.geojson'
        
        // Load all layers and style rules
        atCentLineLayer.loadGeoJson(atCentLineSrc);
        atCentLineLayer.setStyle({
          strokeColor: 'red',
          strokeWeight: 3
        });
        
        var atShelterIconStyle = {
            url: 'https://geo-corps.github.io/ATC/data/icons/roofing-contractor.svg',
            scaledSize: new google.maps.Size(20, 20)
        }
        
        atSheltersLayer.loadGeoJson(atSheltersSrc);
        atSheltersLayer.setStyle({
          icon: atShelterIconStyle
        });
        
        var atParkingIconStyle = {
            url: 'https://geo-corps.github.io/ATC/data/icons/parking.svg',
            scaledSize: new google.maps.Size(10, 10)
        }
                
        atParkingLayer.loadGeoJson(atParkingSrc);
        atParkingLayer.setStyle({
          icon: atParkingIconStyle
        });
        
        // Add Layers to Map
        
        atCentLineLayer.setMap(map);
//        atSheltersLayer.setMap(map);
//        atParkingLayer.setMap(map);
        
        var atCentLineStatus = true;
        $("#btn-atCentLine").click(function() {
            $(this).trigger("blur"); // To dissable focus on button when clicked - temporary solution
            if (atCentLineStatus) {
                atCentLineLayer.setMap(null);
                atCentLineStatus = false;
            }
            else {
                atCentLineLayer.setMap(map);
                atCentLineStatus = true;
            }
        });
        var atSheltersStatus = false;
        $("#btn-atShelters").click(function() {
            $(this).trigger("blur");
            if (atSheltersStatus) {
                atSheltersLayer.setMap(null);
                atSheltersStatus = false;
            }
            else {
                atSheltersLayer.setMap(map);
                atSheltersStatus = true;
            }
        });
        var atParkingStatus = false;
        $("#btn-atParking").click(function() {
            $(this).trigger("blur");
            if (atParkingStatus) {
                atParkingLayer.setMap(null);
                atParkingStatus = false;
            }
            else {
                atParkingLayer.setMap(map);
                atParkingStatus = true;
            }
        });
        
//        $("#btn-atCentLine").off('click');

    };

    </script>
    <!--Load APIs and execute early functions -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      
      
    <script>
    function styleMap() {
        $.getJSON('https://geo-corps.github.io/ATC/basemap-style.json', function(data) { 
        stylesATC = data;
        console.log('h')
        });
    };
    // Run styleMap function to load in base-map style file before map loads
    styleMap();
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8k09vVP7UOyx1IxMo-zoqFRcRTUo-vCw&callback=initMap">
    </script>
  </body>
</html>